<!-- <html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="plotly.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    </head>
    <body>
    <div class="navbar"><span>Real-Time Chart with Plotly.js</span></div>
    <div class="wrapper">
        <div id="chart"></div>
        <script>
            function getData() {
                return Math.random();
            }  
            Plotly.plot('chart',[{
                y:[getData()],
                type:'line'
            }]);
            
            var cnt = 0;
            setInterval(function(){
                Plotly.extendTraces('chart',{ y:[[getData()]]}, [0]);
                cnt++;
                if(cnt > 500) {
                    Plotly.relayout('chart',{
                        xaxis: {
                            range: [cnt-500,cnt]
                        }
                    });
                }
            },15);
        </script>
    </div>
    </body>
</html> -->


<!-- <!DOCTYPE html>
<html>

<head>
    <title>Detect Faces Sample</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
</head>

<body>
    <script type="text/javascript">
        function processImage() {
            var subscriptionKey = "ada93053017649d5b729353cd413d0c8";
            var uriBase =
                "https://practicum1.cognitiveservices.azure.com/face/v1.0/detect";

            // Request parameters.
            var params = {
                "detectionModel": "detection_01",
                "returnFaceId": "true",
                "returnFaceAttributes": "emotion"
            };

            // Display the image.
            var sourceImageUrl = document.getElementById("inputImage").value;
            document.querySelector("#sourceImage").src = sourceImageUrl;

            // Perform the REST API call.
            $.ajax({
                    url: uriBase + "?" + $.param(params),

                    // Request headers.
                    beforeSend: function (xhrObj) {
                        xhrObj.setRequestHeader("Content-Type", "application/json");
                        xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key", subscriptionKey);
                    },

                    type: "POST",

                    // Request body.
                    data: '{"url": ' + '"' + sourceImageUrl + '"}',
                })

                .done(function (data) {
                    // Show formatted JSON on webpage.
                    $("#responseTextArea").val(JSON.stringify(data, null, 2));
                })

                .fail(function (jqXHR, textStatus, errorThrown) {
                    // Display error message.
                    var errorString = (errorThrown === "") ?
                        "Error. " : errorThrown + " (" + jqXHR.status + "): ";
                    errorString += (jqXHR.responseText === "") ?
                        "" : (jQuery.parseJSON(jqXHR.responseText).message) ?
                        jQuery.parseJSON(jqXHR.responseText).message :
                        jQuery.parseJSON(jqXHR.responseText).error.message;
                    alert(errorString);
                });
        };
    </script>
    <h1>Detect Faces:</h1>
    Enter the URL to an image that includes a face or faces, then click
    the <strong>Analyze face</strong> button.<br><br>
    Image to analyze: <input type="text" name="inputImage" id="inputImage"
        value="https://upload.wikimedia.org/wikipedia/commons/c/c3/RH_Louise_Lillian_Gish.jpg" />
    <button onclick="processImage()">Analyze face</button><br><br>
    <div id="wrapper" style="width:1020px; display:table;">
        <div id="jsonOutput" style="width:600px; display:table-cell;">
            Response:<br><br>
            <textarea id="responseTextArea" class="UIInput" style="width:580px; height:400px;"></textarea>
        </div>
        <div id="imageDiv" style="width:420px; display:table-cell;">
            Source image:<br><br>
            <img id="sourceImage" width="400" />
        </div>
    </div>
</body>

</html> -->


<!DOCTYPE html>
<html>

<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <meta charset=utf-8 />
    <title>JS Bin</title>
</head>

<body>
    <input type='file' id="asd" />
    <br>
    <img id="img" src="//placehold.it/1x1/" />
    <div id="base"></div>
    <script>
        // function el(id) {
        //     return document.getElementById(id);
        // } // Get elem by ID

        // function readImage() {
        //     if (this.files && this.files[0]) {
        //         var FR = new FileReader();
        //         FR.onload = function (e) {
        //             el("img").src = e.target.result;
        //             el("base").innerHTML = e.target.result;
        //             // console.log(e.target.result);
        //             return e.target.result;
        //         };
        //         FR.readAsDataURL(this.files[0]);
        //     }
        // }

        // el("asd").addEventListener("change", readImage, false);
    </script>
</body>
<script type="text/javascript">
        var base64;

        makeblob = function (dataURL) {
            var BASE64_MARKER = ';base64,';
            if (dataURL.indexOf(BASE64_MARKER) == -1) {
                var parts = dataURL.split(',');
                var contentType = parts[0].split(':')[1];
                var raw = decodeURIComponent(parts[1]);
                return new Blob([raw], { type: contentType });
            }
            var parts = dataURL.split(BASE64_MARKER);
            var contentType = parts[0].split(':')[1];
            var raw = window.atob(parts[1]);
            var rawLength = raw.length;

            var uInt8Array = new Uint8Array(rawLength);

            for (var i = 0; i < rawLength; ++i) {
                uInt8Array[i] = raw.charCodeAt(i);
            }

            return new Blob([uInt8Array], { type: contentType });
        }

        function el(id) {
            return document.getElementById(id);
        } // Get elem by ID

        function readImage() {
            if (this.files && this.files[0]) {
                var FR = new FileReader();
                FR.onload = function (e) {
                    el("img").src = e.target.result;
                    el("base").innerHTML = e.target.result;
                    // console.log(e.target.result);
                    base64 = e.target.result;
                    processImage(e);
                };
                FR.readAsDataURL(this.files[0]);
            }
        }

        el("asd").addEventListener("change", readImage, false);
    function processImage(e) {
        var subscriptionKey = "ada93053017649d5b729353cd413d0c8";
        var uriBase =
            "https://practicum1.cognitiveservices.azure.com/face/v1.0/detect";

        // Request parameters.
        var params = {
            "detectionModel": "detection_01",
            "returnFaceId": "true",
            "returnFaceAttributes": "emotion"
        };

        // Display the image.
        var sourceImageUrl = document.getElementById("inputImage").value;
        // document.querySelector("#sourceImage").src = sourceImageUrl;
        el("sourceImage").src = e.target.result;
        // console.log("from processImage():" + base64);
        console.log(makeblob(e.target.result));

        // Perform the REST API call.
        $.ajax({
                url: uriBase + "?" + $.param(params),

                // Request headers.
                beforeSend: function (xhrObj) {
                    // xhrObj.setRequestHeader("Content-Type", "application/json");
                    xhrObj.setRequestHeader("Content-Type", "application/octet-stream");
                    xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key", subscriptionKey);
                },

                type: "POST",

                // Request body.
                // data: '{"url": ' + '"' + sourceImageUrl + '"}',
                // data: e.target.result,
                // data: makeblob(document.getElementById("sourceImage").toDataURL()),
                data: makeblob(e.target.result),
                processData: false
            })

            .done(function (data) {
                // Show formatted JSON on webpage.
                $("#responseTextArea").val(JSON.stringify(data, null, 2));
            })

            .fail(function (jqXHR, textStatus, errorThrown) {
                // Display error message.
                var errorString = (errorThrown === "") ?
                    "Error. " : errorThrown + " (" + jqXHR.status + "): ";
                errorString += (jqXHR.responseText === "") ?
                    "" : (jQuery.parseJSON(jqXHR.responseText).message) ?
                    jQuery.parseJSON(jqXHR.responseText).message :
                    jQuery.parseJSON(jqXHR.responseText).error.message;
                alert(errorString);
            });
    };
</script>
<h1>Detect Faces:</h1>
Enter the URL to an image that includes a face or faces, then click
the <strong>Analyze face</strong> button.<br><br>
Image to analyze: <input type="text" name="inputImage" id="inputImage"
    value="https://upload.wikimedia.org/wikipedia/commons/c/c3/RH_Louise_Lillian_Gish.jpg" />
<button onclick="processImage()">Analyze face</button><br><br>
<div id="wrapper" style="width:1020px; display:table;">
    <div id="jsonOutput" style="width:600px; display:table-cell;">
        Response:<br><br>
        <textarea id="responseTextArea" class="UIInput" style="width:580px; height:400px;"></textarea>
    </div>
    <div id="imageDiv" style="width:420px; display:table-cell;">
        Source image:<br><br>
        <img id="sourceImage" width="400" />
    </div>
</div>

</html>